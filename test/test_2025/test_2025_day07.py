from io import StringIO
from pytest import CaptureFixture

from advent_of_code.year_2025.day_07 import Manifold

basic_example = """
.......S.......
...............
.......^.......
...............
......^.^......
...............
.....^.^.^.....
...............
....^.^...^....
...............
...^.^...^.^...
...............
..^...^.....^..
...............
.^.^.^.^.^...^.
...............
"""
def test_manifold_basic(capsys: CaptureFixture[str]):
    f = StringIO(basic_example.lstrip('\n'))

    # create the manifold object using the file
    man = Manifold(f, trace=True)

    # perform a step
    man.step()
    captured = capsys.readouterr()
    assert captured.out == """.......S.......
.......|.......
.......^.......
...............
......^.^......
...............
.....^.^.^.....
...............
....^.^...^....
...............
...^.^...^.^...
...............
..^...^.....^..
...............
.^.^.^.^.^...^.
...............
"""
    man.step()
    captured = capsys.readouterr()
    assert captured.out == """.......S.......
.......|.......
......|^|......
...............
......^.^......
...............
.....^.^.^.....
...............
....^.^...^....
...............
...^.^...^.^...
...............
..^...^.....^..
...............
.^.^.^.^.^...^.
...............
"""
    man.step()
    captured = capsys.readouterr()
    assert captured.out == """.......S.......
.......|.......
......|^|......
......|.|......
......^.^......
...............
.....^.^.^.....
...............
....^.^...^....
...............
...^.^...^.^...
...............
..^...^.....^..
...............
.^.^.^.^.^...^.
...............
"""
    man.step()
    captured = capsys.readouterr()
    assert captured.out == """.......S.......
.......|.......
......|^|......
......|.|......
.....|^|^|.....
...............
.....^.^.^.....
...............
....^.^...^....
...............
...^.^...^.^...
...............
..^...^.....^..
...............
.^.^.^.^.^...^.
...............
"""
    # finish up
    man.run_steps()
    captured = capsys.readouterr()
    assert captured.out == """.......S.......
.......|.......
......|^|......
......|.|......
.....|^|^|.....
.....|.|.|.....
....|^|^|^|....
....|.|.|.|....
...|^|^|||^|...
...|.|.|||.|...
..|^|^|||^|^|..
..|.|.|||.|.|..
.|^|||^||.||^|.
.|.|||.||.||.|.
|^|^|^|^|^|||^|
|.|.|.|.|.|||.|
"""
    assert man.get_splits == 21
